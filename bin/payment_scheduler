#!/usr/bin/env ruby
# encoding: utf-8

trap('INT')  {exit}
trap('TERM') {exit}

$: << File.expand_path("lib")

require "shushu"
require "stalker"

Log.info("starting payment scheduler")
PaymentService.ready_process.each do |pend|
  recid, pmid = pend["receivable_id"], pend["payment_method_id"]
  Log.info("#enqueue_payment_process receivable=#{recid} payment_method=#{pmid}")
  Stalker.enqueue("payment.process",{:recid  => recid, :pmid => pmid})
end
Log.info("stopping payment scheduler")
