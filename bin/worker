#!/usr/bin/env ruby
# encoding: utf-8

trap("INT")  {exit}
trap("TERM") {exit}

$: << File.expand_path("lib")

require "shushu"
require "stalker"
include Stalker

provider_id, token = ENV["PROVIDER_ID"].to_i, ENV["PROVIDER_TOKEN"].to_s
unless Provider.auth?(id, token)
  raise(Shushu::AuthorizationError, "Ensure PROVIDER_ID & PROVIDER_TOKEN are set in the env")
end

job("payment.process") do |args|
  recid, pmid = args["recid"], args["pmid"]
  PaymentService.process(provider_id, recid, pmid)
end
Stalker.work
