#!/usr/bin/env ruby
# encoding: utf-8

trap('INT')  {exit}
trap('TERM') {exit}

$: << File.expand_path("lib")
require "shushu"

usage = "heroku run bundle exec bin/provider name@heroku.com [new_token]"
email = ARGV.shift or abort usage
new_token = ARGV.shift || SecureRandom.hex(128)

provider = Provider.filter(:name => email).first
if provider
  provider.reset_token!(new_token)
  puts("Token updated! \n \t id=#{provider[:id]} \n \t token=#{new_token}")
else
  new_provider = Provider.create :name => email
  new_provider.reset_token!(new_token)
  puts("Provider created! \n \t id=#{new_provider[:id]} \n \t token=#{new_token}")
end
